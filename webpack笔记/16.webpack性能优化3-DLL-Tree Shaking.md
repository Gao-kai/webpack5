## 认识DLL库
DLL的全称叫做Dynamic Link Library也就是动态链接库，最初是在windows系统中为软件实现共享函数库的一种实现方式。
为webpack中也内置了帮助我们实现DLL的功能，是基于DllPlugin和DllReferancePlugin两个插件实现的。

### 使用场景
如果有一个或多个项目中使用到的库比如react、react-dom、vue这种不经常去改变的代码，我们可以使用webpack将其单独编译为一个dll库，以后在项目中使用webpack打包的时候就可以不用再对项目中的react、react-dom、vue的源码进行打包，而是直接引用这个打包好的dll库，这对于多个项目都使用这些库来说，都可以去共享这个打包编译好的dll库而不用每次都打包，在一定程度上会优化webpack打包过程中的体积和速度。

在webpack4之后，React和Vue官方的脚手架都移除了对于DLL库的引用，因为webpack4在打包时的效率已经足够的高，所以不是很推荐使用DLL来对项目进行打包时的优化。

使用dll库分为两步：
1. 第一步在独立的项目中打包一个dll库
2. 第二步在要使用dll库的项目中引入
### 打包DLL库
下面是一个完整的将react和react-dom打包为DLL库的过程：
1. 新建项目初始化，安装webpack和webpack-cli
```bash
npm init -y
npm i webpack webpack-cli -D
```
2. 安装react和react-dom
```bash
npm i react react-dom -D
```
3. 新建webpack.dll.js配置文件，配置打包dll库选项
+ Dllplugin是webpack内置的插件，无需安装，开箱即用。
```js
// webpack.dll.js配置文件
const path = require('path');
const { DllPlugin } = require('webpack'); 
const TerserPlugin = require('terser-webpack-plugin')

module.exports = {
	mode:'production',
	entry:{
		react:['react','react-dom']
	},
	// output用于指定react和react-dom打包后的产物所在文件夹位置
	output:{
		path:path.resolve(__dirname,'./dll'),
		filename:"dll_[name].js",
		library:'dll_[name]'
	},
	// 不抽取第三方包的注释为单独的LICENSE.txt文件
	optimization:{
		minimizer:[
			new TerserPlugin({
				extractComments:false
			})
		]
	},
	plugins:[
		// 设置DLL库的名称和生成的manifest.jsonwen配置文件存放目录
		new DllPlugin({
			name:'dll_v_[name]',
			path:path.resolve(__dirname,"./dll/dll_v_[name].manifest.json")
		})
	]
}
```
4. 配置启动脚本
```json
{
	"scripts": {
		"dll": "webpack --config ./webpack.dll.js"
	}
}
```
5. 执行脚本，获得DLL库产物
```js
|---dll
	|---dll_react.js
	|---dll_v_react.manifest.json
```

### 使用DLL库
如果我们的某个项目中使用了react和react-dom相关的代码，此时我们就可以直接引入这个编译好的dll_react库，配置之后在打包项目代码的时候就不会对react库代码进行重复编译，而是直接去读取dll库中编译好的代码。

1. 将dll库拷贝到当前项目
2. 在当前项目中进行DllReferencePlugin插件的配置
```js
module.exports = {
	plugins:[
		new webpack.DllReferencePlugin({
			manifest:resolvePath('./dll/dll_v_react.manifest.json'),
			context:resolvePath('./')
		})
	]
}
```
3. 重新执行打包，在控制台会输出下面这句话，代表从dll配置成功
```bash
delegated ./node_modules/react/index.js from dll-reference dll_v_react 42 bytes [built] [code generated]
delegated ./node_modules/react-dom/index.js from dll-reference dll_v_react 42 bytes [built] [code generated]
```
4. 安装add-asset-html-webpack-plugin插件
```bash
npm i add-asset-html-webpack-plugin -D
```

5. 使用add-asset-html-webpack-plugin插件将dll_react.js文件复制一份放入到dist目录中，并在打包后的index.html中自动引入
```js
const AddAssetHtmlWebpackPlugin = require('add-asset-html-webpack-plugin');
module.exports = {
	plugins:[
		new webpack.DllReferencePlugin({
			manifest:resolvePath('./dll/dll_v_react.manifest.json'),
			context:resolvePath('./')
		}),
		new AddAssetHtmlWebpackPlugin({
			filepath:resolvePath('./dll/dll_react.js')
		})
	]
}
```
