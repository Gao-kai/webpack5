## Babel是什么
在当前的前端项目开发中，虽然我们不会直接的去接触Babel，但是Babel在整个前端工程化中起着非常重要的作用,比如：
1. 开发中使用的ES6+语法需要Babel
2. 开发中使用的TypeScript语法需要Babel
3. 开发React项目时的JSX语法都需要Babel

#### 那么Babel究竟是什么呢？
Babel的官方文档对其的描述是：Babel是一个JavaScript编译器，也可以说Babel是一个工具链。
Babel主要用于将采用ES6+语法编写的代码转换为向后兼容的JavaScript语法代码，以便于能够运行在当前和旧版本的浏览器或者其他环境中。

#### Babel可以做哪些事情？
1. 语法转化，比如将ES6+语法转化为ES5语法
2. 源代码转化，比如将JSX的源码转化为ES5语法
3. 通过Polyfill方式在目标环境中添加缺失的特性

## Babel的命令行工具
Babel本身就可以作为一个独立的工具使用而不借助于webpack等构建工具，如果要单独使用Babel做一些转化工作，那么就需要安装Babel的核心库和命令行工具。
```bash
npm i @babel/core -D  安装Babel的核心库，必须安装
npm i @babel/cli -D   安装Babel的命令行工具，这是通过命令行单独使用Babel的前提
```

现在需要将index.js的如下ES6代码通过Babel命令行的命令将其转化为ES5语法
```js
// src/index.js
const sum = (a,b)=>{
	return a+b;
}
```

在命令行工具中输入命令：代表通过babel工具将./src/index.js文件中的代码转化之后输出到当前目录下的dist文件夹中
```bash
npx babel ./src/index.js --out-dir dist
```

但是，通过上述命令转化之后代码并没有被转换：
```js
// dist/index.js
const sum = (a, b) => {
  return a + b;
};
```
这是因为Babel和PostCSS工具有点类似，Babel本身并不对代码进行任何转化，真正实现转换代码的是Babel的插件plugin，比如我们这里需要将箭头函数转化为普通函数，就需要先安装Babel专门用于转化箭头函数的插件@babel/plugin-transform-arrow-functions:
```bash
npm i @babel/plugin-transform-arrow-functions -D
```

安装完成之后再次执行命令，不过这次需要带上插件：--plugin参数代表在编译过程中需要执行的插件
```bash
npx babel ./src/index.js --out-dir dist --plugins=@babel/plugin-transform-arrow-functions
```

转化完成之后发现箭头函数已经被转化为普通函数，但是const这种声明变量的写法依旧没有被转化:
```js
const sum = function (a, b) {
  return a + b;
};
```

此时就要用到另外一个插件：@babel/plugin-transform-block-scoping，安装该插件并执行命令：
```bash
npm i @babel/plugin-transform-block-scoping -D
```

再次执行babel命令：
```bash
npx babel ./src/index.js --out-dir dist --plugins=@babel/plugin-transform-arrow-functions,@babel/plugin-transform-block-scoping
```

发现const和箭头函数都被转化为ES5语法：
```js
var sum = function (a, b) {
  return a + b;
};
```

## Babel的预设preset
我们思考一个问题，在实际的开发中我们可能写各种ES6+语法来开发项目，难道我们每一个都需要手动下载对应的插件然后使用么？幸好babel官方为我们提供了babel转化的预设(preset)。一个预设可以看做是一个整合了多个插件的集合，就不用我们一一去配置插件。

使用Babel预设的前提是安装@babel/preset-env包：
```bash
npm i @babel/preset-env -D
```

还是用上面的例子，我们直接执行babel命令并使用预设：
```bash
npx babel ./src/index.js --out-dir dist --presets=@babel/preset-env
```

可以直接完成转化：
```js
"use strict";

var sum = function sum(a, b) {
  return a + b;
};
```

## Babel的底层原理
Babel的官方文档说Babel是一个JavaScript的编译器。一般来说，编译器都有下面三个流程用于将源代码转化成为目标代码：
1. 解析阶段Parsing:将源代码解析为AST抽象语法树
2. 转换阶段Transformation：遍历抽象语法树将其转化为新的抽象语法树
3. 生成阶段Code Generator：生成目标代码

那么Babel作为JavaScript的编译器，是如何将诸如ES6+、JSX等这些源代码，转化为浏览器可以直接识别的目标代码的呢？其实Babel在编译的过程中也具有以上三个阶段，详细的Babel编译器工作原理如下图所示：
![Babel编译器执行过程](07_files/1.jpg)
词法分析 分析出来代码里面每一个词 比如变量名 空格 标点符号token单元，
生成一个tokens数组 对每一个token做一个分类
数组中是一个个的对象
Punctuator 运算符

然后进行语法分析
对不同的语言进行不同的翻译
如果在js语言中，会对进行一个判断

最后生成一个AST抽象语法树

body两个对象

每个对象有type和declartions/CallExpression等
declartions是一个数组 里面又是一个个的对象
{
	type
	id
	init
}

转为树结构
深度遍历
查找树上面的每一个阶段

遍历的时候就访问里面的每一个节点
在访问的过程中应用插件,基于插件提供的功能对节点进行修改

遍历完成之后得到一个新的AST 抽象语法树
再 基于这个新的AST生成目标代码


[](https://github.com/jamiebuilds/the-super-tiny-compiler/blob/master/the-super-tiny-compiler.js)